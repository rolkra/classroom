---
title: "Datenschatz Suche - Teil 1"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
# rmarkdown settings
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

# packages
library(tidyverse)
library(explore)
library(tidydice)

# user defined function
add_line <- function(
  plot, x = 0, color = "red", size = 1, alpha = 0.75)  {
  plot + geom_vline(
    xintercept = x, color = color, alpha = alpha, size = size)
}
```

# Einführung

![](images/treasure-map-1.jpg){width="800"}

**Du interessierst dich für Advanced Analytics und Data Science und möchtest es einfach mal ausprobieren?**

Entdecke auf spielerische Art grundlegende Advanced Analytics Konzepte und Arbeitsweisen. Wir suchen gemeinsam nach spannenden Mustern in Daten und verwenden dafür das Data Science Tool R/RStudio (über Webbrowser). Alles was du brauchst sind Interesse am Thema und ein Computer mit Teams und Chrome- oder Firefox-Browser. Keine Programmiererfahrung notwendig.

**Nicht-Ziele:**

-   Data Science Ausbildung
-   Programmier Kurs
-   Data Science Tools Einschulung
-   Fachbegriffe lernen
-   Frontalvortrag

**Ziele:**

-   Gemeinsames spielerisches Erarbeiten
-   Was "tut" man (und wie "denkt" man) als "Data Scientist"

## Rstudio.cloud

RStudio ist ein Datascience Tool das entweder lokal, oder über Webzugang (Cloud) verwendet werden kann.

-   Links oben = Code Editor
-   Links unten = Console (Ausgabe von Text)
-   Rechts oben = Anzeige von Daten und Variablen
-   Rechts unten = Anzeige von Files und Plots

Wir arbeiten hauptsächlich im Code Editor!

## Notebook Help

Notebooks sind ein typisches Data Science Werkzeug. Sie enthalten Code, das Ergebnis von Code (z.B. Grafiken) und Text/Dokumentation in einem einzigen Dokument. Vorteil: alles ist an einem Ort, und alle Schritte sind nachvollziehbar (reproducible data science)

In RStudio kannst du ein neues Notebook mit `File > New File > R Notebook` anlegen

Du kannst Text und Code direkt ändern.

Einen neuen "Code Chunk" kannst du mit `Insert > Code Chunk…` anlegen (oder einfach mit Copy & Paste oder mit `<strg> <alt> i`). Zum Testen verwenden wir die Funktion `print`, die einfach nur den Text ausgibt.

```{r}
print("Auf geht's zur Datenschatz Suche!")
```

Den Code kann du ausführen, indem du in den Text klickst und danach auf den grünen "Play Button" klickst. Achte auf die Reihenfolge.

[Jetzt Du! ...]

Einige praktische Tastenkürzel / Icons:

| Tastenkürzel / Icon                                                  | Bedeutung                              |
|----------------------------------------------------------------------|----------------------------------------|
| `F1`                                                                 | Hilfe                                  |
| `<strg> +`                                                           | Schrift vergrößern                     |
| `<strg> -`                                                           | Schrift verkleinern                    |
| `<strg> <alt> i`                                                     | Code Chunk einfügen ("insert")         |
| `<strg> <shift> m`                                                   | pipe operator %\>% (und dann "mach")   |
| Click ![](images/rstudio-icon-structure.png){width="29" height="20"} | Dokument Struktur anzeigen / verbergen |
| Click ![](images/rstudio-icon-wysiwyg.png){width="31" height="20"}   | Visual Markdown Editor / Source Editor |
| Click ![](images/rstudio-icon-knit.png "Knit"){width="46"}           | Erzeuge ein HTML-File                  |

Einige Funktionen die wir verwenden:

| Funktion         | Bedeutung                           |
|------------------|-------------------------------------|
| `describe()`     | Beschreiben                         |
| `explore()`      | Grafisch erforschen                 |
| `add_line()`     | Eine Linie in Grafik einfügen       |
| `filter()`       | Filtern (welche Kunden behalten?)   |
| `explain_tree()` | Erkläre mit einem Entscheidungsbaum |

## Coding

Als Data Scientist arbeitet man oft mit einer Programmiersprache (R oder Python) und einer Entwicklungsumgebung (z.B. RStudio oder Jupyter)

Durch die Verwendung von Code sind die einzelnen Abeitsschritte genau und reproduzierbar dokumentiert. Zudem kann auf die Arbeit von vielen anderen Data Scientists zurück gegriffen werden. Es gibt z.B. über 10.000 Pakete auf CRAN die R um spezielle Funktionen im Bereich Statistik und Data Science erweitern.

Hier im Kurs verwenden wir die Pakete {tidyverse} und {explore}

{explore} ist auf [CRAN](https://CRAN.R-project.org/package=explore "explore"). Dort findest du auch weitere [Beispiele](https://cran.r-project.org/web/packages/explore/vignettes/explore_penguins.html "explore-penguins") wie man es nutzt.

## Prozess

Es gibt (vereinfacht) 4 grundlegende Schritte:

-   Business Understanding: Um was geht es?
-   Data Understanding: Was bedeuten die Daten?
-   Finding Insights: Finde nützliche Muster!
-   Storytelling: Erzähle eine (wahre) Geschichte!

# Business Understanding

Es wurde ein neues Produkt entwickelt, und das Kaufinteresse an 1000 Personen getestet. Du bekommst nun die Daten und sollst herausfinden, für wen das Produkt besonders gut geeignet ist.

Eine andere Anayse hat bereits ergeben, dass vor allem Kunden mit geringer Breitband Internet Usage (bbi_usg_gb) und Kunden ohne Mobile Voice Produkt (mobilevoice_ind == 0) an dem Produkt interessiert sind.

Hypothesen für Kaufinteresse:

-   **Kunden mit geringer Internet Usage (bbi_usg_gb)**:\
    Die durchschnittliche bbi_usg_gb bei Kaufinteresse = 72, ohne Kaufinteresse = 174.

-   **Kunden ohne Mobile Voice Produkt (mobilevoice_ind == 0)**:\
    58% der Käufer haben kein Mobile Voice Produkt

Soll das Produkt nur diesen Kunden angeboten werden?

# Data Understanding

Die Daten sind als `data` abgespeichert. Die Variable `buy` enthält die Info, ob der Kunde ein Kaufinteresse hat (buy == 1) oder nicht (buy == 0).

```{r message=FALSE}
data <- read_csv("data-buy.csv")
```

## buy

Wir machen uns zuerst einen Überblick über die Variable `buy`

```{r}
data %>% describe(buy)
```

Ca. 16% von den insgesamt 1000 Kunden haben gekauft (buy == 1)

## age

Danach schauen wir uns die Variable `age` an:

Welche Altersverteilung wäre zu erwarten? Was wäre plausibel?

```{r}
data %>% describe(age)
```

Die Kunden sind zwischen 18 und 93 Jahr alt. Das Durchschnittsalter (mean) beträgt 57.7 Jahre.

Einen besseren Überblick bekommen wir, wenn wir uns das Alter grafisch ausgeben:

```{r fig.height=3}
data %>% explore(age)
```

Auf der X-Achse sieht man das Alter (sehr kleine und sehr große Werte werden automatisch ausgeblendet). Der "Hügel" (Histogramm) zeigt an, welche Altersgruppen wie häufig vorkommen. Der "Gipfel" des Hügels liegt hier ca. beim Mittelwert.

Wir können den Mittelwert mit einer Linie einzeichnen:

```{r fig.height=3}
data %>% explore(age) %>% add_line(57.7)
```

## female_ind

```{r fig.height=3}
data %>% explore(female_ind)
```

## city_ind

```{r fig.height=3}
data %>% explore(city_ind)
```

## fixedvoice_ind

```{r fig.height=3}
data %>% explore(fixedvoice_ind)
```

## fixeddata_ind

```{r fig.height=3}
data %>% explore(fixeddata_ind)
```

## fixedtv_ind

```{r fig.height=3}
data %>% explore(fixedtv_ind)
```

## mobilevoice_ind

```{r fig.height=3}
data %>% explore(mobilevoice_ind)
```

## mobiledata_ind

```{r fig.height=3}
data %>% explore(mobiledata_ind)
```

## bbi_speed

```{r fig.height=3}
data %>% explore(bbi_speed_ind)
```

## bbi_usg_gb

```{r fig.height=3}
data %>% describe(bbi_usg_gb)
```

Mittelwert (mean) und Median liegen sehr weit auseinander. Das bedeutet, es gibt hier Extremwerte (die den Mittelwert nach oben verzerren). Der max-Wert liegt bei 100.000 GB (100 Terrabyte)

```{r fig.height=3}
data %>% 
  explore(bbi_usg_gb) %>% 
  add_line(58) %>% 
  add_line(158)
```

```{r}
data %>% filter(bbi_usg_gb >= 1000) %>% describe(bbi_usg_gb)
```
Es handelt sich um einen einzigen Ausreißer.

## hh_single

```{r fig.height=3}
data %>% explore(hh_single)
```

## event_web

```{r fig.height=3}
data %>% explore(event_web)
```

# Finding Insights

## age

```{r fig.height=3}
data %>% explore(age, target = buy)
```

## other

```{r fig.height=2, fig.width=6}
data %>% select(buy, city_ind, fixeddata_ind) %>% explore_all(target = buy)
```

```{r fig.height=2, fig.width=6}
data %>% select(buy, fixedvoice_ind, fixedtv_ind) %>% explore_all(target = buy)
```

```{r fig.height=2, fig.width=6}
data %>% select(buy, mobilevoice_ind, mobiledata_ind) %>% explore_all(target = buy)
```

```{r fig.height=2, fig.width=6}
data %>% select(buy, bbi_speed_ind, bbi_usg_gb) %>% explore_all(target = buy)
```

```{r fig.height=2, fig.width=6}
data %>% select(buy, hh_single, event_web) %>% explore_all(target = buy)
```

Starke Muster sind erkennbar bei age, city_ind, fixedtv_ind, bbi_speed_ind und bbi_usg_gb. 

## Multivariat

Wir haben etliche Muster gefunden. Aber welche sind besonders wichtig, und wie hängen sie zusammen?

Ein Entscheidungsbaum (Decision Tree) kann uns die Zusammenhänge erklären:

```{r}
data %>% explain_tree(target = buy)
```

## Machine Learning

Der Decision Tree Algorithmus "lernt" welche Kunden eher kaufen. Nun können wir ein Modell erstellen und eine Vorhersage machen:

```{r include=FALSE}
model <- data %>%
  select(age, female_ind, bbi_usg_gb, buy) %>% 
  explain_tree(target = buy, out = "model")
```

```{r}
predict(
  model, 
  tibble(age = 40, female_ind = 0, bbi_usg_gb = 10)
)
```

Wir erhalten die vorhergesagten Wahrscheinlichkeiten für Nicht-Kauf und Kauf (buy)

## Hypothesen

### Geringe BBI Usage

Eine andere Anayse hat bereits ergeben, dass vor allem Kunden mit geringer Breitband Internet Usage (bbi_usg_gb) an dem Produkt interessiert sind (Durchschnittliche bbi_usg_gb bei Kaufinteresse = 72, ohne Kaufinteresse = 174).

```{r}
data %>% filter(buy == 1) %>% describe(bbi_usg_gb)
```

[Jetzt Du! ...]

### Kein Mobile Voice

Eine andere Analyse hat bereits ergeben, dass vor allem Kunden ohne Mobile Voice an dem Produkt interessiert sind (58% der Käufer haben kein Mobile Voice Produkt).

[Jetzt Du! ...]

# Story Telling

Welchen Kunden soll das Produkt angeboten werden und warum? Erzähle eine "Geschichte", die alle wesentlichen Insights enthält, aber trotzdem für einen Data Science Laien einfach verständlich und nachvollziehbar ist!

[Jetzt Du! ...]
